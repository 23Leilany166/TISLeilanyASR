<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Diseño de la Base de Datos del Subsistema - Planos</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        color: #333;
        margin: 0;
        padding: 20px;
    }

    a {
        text-decoration: none;
        color: #777;
        padding: 10px 15px;
        border-radius: 5px;
        margin-right: 10px;
        transition: color 0.3s, background-color 0.3s;
    }

    a:hover {
        color: white;
        background-color: #555;
    }

    /* Títulos con colores fríos oscuros */
    h1 {
        background-color: #2C3E50; /* Azul grisáceo oscuro */
        color: white;
        padding: 10px;
        border-radius: 5px;
        margin-top: 20px;
    }

    h2 {
        background-color: #34495E; /* Azul oscuro */
        color: white;
        padding: 10px;
        border-radius: 5px;
        margin-top: 15px;
    }

    h3 {
        background-color: #1A5276; /* Azul petróleo oscuro */
        color: white;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
    }

    pre {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        overflow-x: auto;
    }

    ul {
        margin: 10px 0;
        padding-left: 20px;
    }

    img {
        max-width: 100%;
        height: auto;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
</style>

</head>
<body>

    <nav>
        <a href="../TISLeilanyASR/index.html">[Inicio]</a>
        <a href="../TISLeilanyASR/Clientes.html">[Clientes]</a>
        <a href="../TISLeilanyASR/Trabajadores.html">[Trabajadores]</a>
        <a href="../TISLeilanyASR/Planos.html">[Planos]</a>
        <a href="../TISLeilanyASR/Proveedores.html">[Proveedores]</a>
    </nav>

    <h1>Diagrama de la Base de Datos</h1>
    <img src="../TISLeilanyASR/BDPlanos.png" alt="Diagrama de la base de datos" width="800" />

    <h1>Descripción de la Base de Datos de Planos</h1>

    <h2>Propósito General</h2>
    <p>La base de datos de Planos está diseñada para gestionar los planos de construcción dentro de los proyectos de la constructora. Incluye información sobre los planos, el encargado de cada plano, el proyecto asociado, y la relación entre estos planos y los trabajadores encargados. Esta base de datos es crucial para asegurar que toda la información técnica esté organizada, actualizada y accesible para los roles pertinentes como arquitectos, supervisores e ingenieros.</p>

    <h2>Tabla Planos</h2>
    <h3>Propósito</h3>
    <p>La tabla Planos almacena información detallada de cada plano de construcción, incluyendo un código único, la ubicación física (calle y número), el proyecto asociado y la fecha de creación del plano. Este registro es esencial para controlar la disponibilidad y el estado de cada plano dentro del proyecto.</p>

    <h3>Campos</h3>
    <ul>
        <li><strong>ID_Plano:</strong> Clave primaria única que identifica cada plano en la base de datos. Está configurada como IDENTITY para auto-incrementarse automáticamente con cada nuevo plano.</li>
        <li><strong>Código:</strong> Un código único para cada plano. Este código es utilizado para identificar de manera rápida y eficiente cada plano.</li>
        <li><strong>Calle:</strong> La ubicación física donde se encuentra el proyecto relacionado con el plano. Es esencial para la logística y organización del proyecto.</li>
        <li><strong>Número:</strong> Número o versión del plano, útil para hacer referencia a la versión más reciente o modificada del plano.</li>
        <li><strong>ProyectoAsociado:</strong> Referencia al proyecto asociado a este plano. Este campo puede estar relacionado con una tabla de proyectos que contenga la información de cada proyecto específico.</li>
        <li><strong>Encargado:</strong> ID del trabajador encargado de este plano. Este trabajador puede ser un arquitecto, ingeniero o supervisor que esté a cargo de coordinar el plano y su implementación en obra.</li>
        <li><strong>FechaCreacion:</strong> La fecha en la que se creó el plano. Este campo se establece por defecto con la fecha actual de creación, lo que facilita el seguimiento histórico de cada plano.</li>
    </ul>

    <h2>Relaciones Importantes</h2>
    <p>La base de datos de Planos está interrelacionada con otras tablas clave, como Clientes, Trabajadores, y Proveedores. Estas relaciones aseguran que la información esté organizada y accesible para los trabajadores clave del proyecto, como arquitectos, ingenieros y supervisores.</p>

    <h3>Tabla Clientes_Planos</h3>
    <h3>Propósito</h3>
    <p>La tabla Clientes_Planos establece una relación entre los Clientes y los Planos. Un cliente puede tener varios planos asociados a diferentes proyectos, y un plano puede estar relacionado con varios clientes. Esta relación facilita la asignación de planos a proyectos específicos de los clientes y optimiza la gestión de recursos.</p>

    <h3>Campos</h3>
    <ul>
        <li><strong>ID_Cliente:</strong> Clave foránea que hace referencia a la tabla Clientes, indicando qué cliente está asociado con el plano.</li>
        <li><strong>ID_Plano:</strong> Clave foránea que hace referencia a la tabla Planos, indicando qué plano está asociado con el cliente en cuestión.</li>
    </ul>

    <h3>Tabla Planos_Trabajadores</h3>
    <h3>Propósito</h3>
    <p>La tabla Planos_Trabajadores establece qué trabajador está encargado de qué plano y qué rol desempeña. Los roles pueden ser de arquitecto, ingeniero o supervisor, y permiten asignar responsabilidades claras para la gestión de los planos y asegurar que cada plano esté debidamente supervisado y ejecutado.</p>

    <h3>Campos</h3>
    <ul>
        <li><strong>ID_Plano:</strong> Clave foránea que hace referencia a la tabla Planos, indicando qué plano está asociado con el trabajador.</li>
        <li><strong>ID_Trabajador:</strong> Clave foránea que hace referencia a la tabla Trabajadores, indicando qué trabajador está vinculado al plano en cuestión.</li>
        <li><strong>Rol:</strong> Rol del trabajador en relación con el plano. Puede ser "Arquitecto", "Ingeniero" o "Supervisor", dependiendo del nivel de acceso y responsabilidad del trabajador con el plano.</li>
    </ul>

    <h3>Tabla Planos - Relación con Proyectos</h3>

    <h3>Propósito</h3>
    <p>
        La tabla <strong>Planos</strong> está directamente relacionada con la tabla <strong>Proyectos</strong>. 
        Cada plano pertenece a un proyecto específico, lo cual se representa mediante el campo <code>ProyectoAsociado</code> que funciona como clave foránea. 
        Esta relación permite mantener organizada la documentación técnica, facilitando la consulta y el seguimiento de los planos dentro de cada proyecto de construcción.
    </p>

    <h3>Campos relacionados</h3>
    <ul>
        <li><strong>ID_Plano:</strong> Clave primaria de la tabla <em>Planos</em>, que identifica de forma única cada plano.</li>
        <li><strong>ProyectoAsociado:</strong> Clave foránea que hace referencia al campo <em>ID_Proyecto</em> de la tabla <em>Proyectos</em>, indicando a qué proyecto pertenece el plano.</li>
    </ul>

    <h3>Tipo de Relación</h3>
    <p><strong>Uno a muchos</strong>: Un proyecto puede tener varios planos, pero cada plano pertenece a un solo proyecto.</p>

    <h2>Código SQL para crear las tablas</h2>
    <pre><code>
CREATE DATABASE BDPlanos;
USE BDPlanos;

-- Tabla de Proyectos (debe ir primero porque Planos depende de ella)
CREATE TABLE PROYECTOS (
    ID_Proyecto INT PRIMARY KEY IDENTITY(1,1),
    Nombre NVARCHAR(100) NOT NULL,
    Descripcion NVARCHAR(255),
    FechaInicio DATE,
    FechaFin DATE
);

-- Tabla de Trabajadores (debe ir antes de Planos porque es referenciada en tabla detalle)
CREATE TABLE TRABAJADORES (
    ID_Trabajador INT PRIMARY KEY IDENTITY(1,1),
    Nombre NVARCHAR(50) NOT NULL,
    Apellido_Paterno NVARCHAR(50) NOT NULL,
    Apellido_Materno NVARCHAR(50),
    Fecha_Nacimiento DATE NOT NULL,
    Direccion NVARCHAR(100),
    Telefono NVARCHAR(15),
    Correo_Electronico NVARCHAR(50) UNIQUE,
    Fecha_Ingreso DATE NOT NULL,
    Cargo NVARCHAR(50),
    Hora_Entrada TIME,
    Hora_Salida TIME
);

-- Tabla de Planos (sin referencia directa a Trabajadores)
CREATE TABLE PLANOS(
    ID_Plano INT PRIMARY KEY IDENTITY(1,1),
    Código NVARCHAR(50) NOT NULL,
    Calle NVARCHAR(255) NOT NULL,
    Número NVARCHAR(10) NOT NULL,
    ProyectoAsociado INT NOT NULL,
    FechaCreacion DATE NOT NULL DEFAULT GETDATE(),
    FOREIGN KEY (ProyectoAsociado) REFERENCES PROYECTOS(ID_Proyecto)
);

-- Tabla de Clientes
CREATE TABLE CLIENTES (
    ID_Cliente INT PRIMARY KEY IDENTITY(1,1),
    Nombre NVARCHAR(100) NOT NULL,
    Apellido_Paterno NVARCHAR(100),
    Apellido_Materno NVARCHAR(100),
    Correo NVARCHAR(100) NOT NULL,
    Teléfono NVARCHAR(15) NOT NULL,
    Dirección NVARCHAR(255) NOT NULL,
    Sexo NVARCHAR(10) NOT NULL,
    Fecha_nacimiento DATE NOT NULL,
    Edad INT
);

-- Relación muchos a muchos entre Clientes y Planos
CREATE TABLE CLIENTES_PLANOS (
    ID_Cliente INT,
    ID_Plano INT,
    FechaAsignacion DATE DEFAULT GETDATE(),
    EstadoPlano NVARCHAR(50),         -- Ej: 'En revisión', 'Aprobado'
    Comentarios NVARCHAR(255),
    PRIMARY KEY (ID_Cliente, ID_Plano),
    FOREIGN KEY (ID_Cliente) REFERENCES CLIENTES(ID_Cliente),
    FOREIGN KEY (ID_Plano) REFERENCES PLANOS(ID_Plano)
);

-- Relación muchos a muchos entre Planos y Trabajadores, con rol
CREATE TABLE PLANOS_TRABAJADORES (
    ID_Plano INT,
    ID_Trabajador INT,
    Rol NVARCHAR(50) NOT NULL,
    FechaAsignacion DATE DEFAULT GETDATE(),
    FechaFin DATE,
    Activo BIT DEFAULT 1,
    Notas NVARCHAR(255),
    FOREIGN KEY (ID_Plano) REFERENCES PLANOS(ID_Plano),
    FOREIGN KEY (ID_Trabajador) REFERENCES TRABAJADORES(ID_Trabajador)
);
    </code></pre>

    <h1>Código SQL para agregar registros a las tablas</h1>

    <h3>Registro de Planos</h3>
    <pre><code>
INSERT INTO Planos (Código, Calle, Número, ProyectoAsociado, Encargado, FechaCreacion) VALUES
('PL-001', 'Av. Siempre Viva', '123', 1, 1, GETDATE()),
('PL-002', 'Calle Insurgentes', '456', 2, 2, GETDATE());
    </code></pre>

    <h3>Registro de Clientes</h3>
    <pre><code>
INSERT INTO Clientes (Nombre, Apellido_Paterno, Apellido_Materno, Correo, Teléfono, Dirección, Sexo, Fecha_nacimiento, Edad) VALUES
('Carlos', 'García', 'Martínez', 'carlos.garcia@example.com', '555-0201', 'Calle Principal 789', 'M', '1980-10-10', 45),
('Ana', 'Rodríguez', 'Sánchez', 'ana.rodriguez@example.com', '555-0202', 'Calle Secundaria 101', 'F', '1992-06-20', 33);
    </code></pre>

</body>
</html>
